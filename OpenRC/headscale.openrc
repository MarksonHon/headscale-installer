#!/sbin/openrc-run

name=$RC_SVCNAME
description="headscale coordination server for Tailscale"
command="/usr/local/bin/headscale"
command_args="serve"
command_user="headscale"
capabilities="cap_net_bind_service"

depend() {
	after net 
	need net
}

start_pre() {
	if ! $command configtest; then
		eerror "Config test failed, edit your config file and try again."
		return 1
	fi
}

reload() {
	ebegin "Reloading $RC_SVCNAME"
	/usr/bin/kill -HUP $MAINPID
	eend $?
}